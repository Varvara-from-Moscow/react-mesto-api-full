{"ast":null,"code":"import _toConsumableArray from\"/Users/varvarakorableva/Desktop/react-mesto-auth/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"/Users/varvarakorableva/Desktop/react-mesto-auth/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React from'react';import{Route,Switch,Redirect,useHistory}from'react-router-dom';import{CurrentUserContext}from'../contexts/CurrentUserContext';import*as Auth from'./Auth';import{api}from'../utils/Api';import Header from'./Header';import MyProfile from'./MyProfile';import Footer from'./Footer';import DeletePopup from'./DeletePopup';import ImagePopup from'./ImagePopup';import EditAvatarPopup from'./EditAvatarPopup';import EditProfilePopup from'./EditProfilePopup';import AddPlacePopup from'./AddPlacePopup';import Login from'./Login';import Register from'./Register';import ProtectedRoute from\"./ProtectedRoute\";import InfoTooltip from'./InfoTooltip';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function App(){var _React$useState=React.useState([]),_React$useState2=_slicedToArray(_React$useState,2),cards=_React$useState2[0],setCards=_React$useState2[1];var _React$useState3=React.useState({}),_React$useState4=_slicedToArray(_React$useState3,2),currentUser=_React$useState4[0],setCurrentUser=_React$useState4[1];var _React$useState5=React.useState(false),_React$useState6=_slicedToArray(_React$useState5,2),isEditProfilePopupOpen=_React$useState6[0],setIsEditProfilePopupOpen=_React$useState6[1];var _React$useState7=React.useState(false),_React$useState8=_slicedToArray(_React$useState7,2),isAddPlacePopupOpen=_React$useState8[0],setIsAddPlacePopupOpen=_React$useState8[1];var _React$useState9=React.useState(false),_React$useState10=_slicedToArray(_React$useState9,2),isEditAvatarPopupOpen=_React$useState10[0],setIsEditAvatarPopupOpen=_React$useState10[1];var _React$useState11=React.useState(false),_React$useState12=_slicedToArray(_React$useState11,2),isDeletePopupOpen=_React$useState12[0],setIsDeletePopupOpen=_React$useState12[1];var _React$useState13=React.useState(false),_React$useState14=_slicedToArray(_React$useState13,2),isInfoTooltip=_React$useState14[0],setIsInfoTooltip=_React$useState14[1];var _React$useState15=React.useState({}),_React$useState16=_slicedToArray(_React$useState15,2),selectedCard=_React$useState16[0],setSelectedCard=_React$useState16[1];var _React$useState17=React.useState(false),_React$useState18=_slicedToArray(_React$useState17,2),showLoading=_React$useState18[0],setShowLoading=_React$useState18[1];var _React$useState19=React.useState({}),_React$useState20=_slicedToArray(_React$useState19,2),selectedCardToDelete=_React$useState20[0],setSelectedCardToDelete=_React$useState20[1];var _React$useState21=React.useState(false),_React$useState22=_slicedToArray(_React$useState21,2),loggedIn=_React$useState22[0],setLoggedIn=_React$useState22[1];var _React$useState23=React.useState(false),_React$useState24=_slicedToArray(_React$useState23,2),noMistake=_React$useState24[0],setNoMistake=_React$useState24[1];var _React$useState25=React.useState(\"\"),_React$useState26=_slicedToArray(_React$useState25,2),userEmail=_React$useState26[0],setUserEmail=_React$useState26[1];var history=useHistory();function signOut(){localStorage.removeItem('jwt');//// как его удалить?\nsetLoggedIn(false);setUserEmail(\"\");history.push('/login');}function handleRegSubmit(login){Auth.register({password:login.password,email:login.email}).then(function(){setNoMistake(true);setIsInfoTooltip(true);}).then(function(res){history.push('/login');}).catch(function(err){setIsInfoTooltip(true);setNoMistake(false);console.log(err);});}function handleLogin(password,email){Auth.authorize(password,email).then(function(token){Auth.getContent(token)//.then(()=>{console.log(token)})\n.then(function(){setUserEmail(email);setLoggedIn(true);history.push('/my-profile');}).catch(function(err){console.log(err);});});}React.useEffect(function(){tokenCheck();},[]);function tokenCheck(){// если у пользователя есть токен в localStorage,\n// эта функция проверит валидность токена\nvar jwt=localStorage.getItem('jwt');if(jwt){// проверим токен\nAuth.getContent(jwt).then(function(res){if(res){// авторизуем пользователя\nsetLoggedIn({loggedIn:true},function(){// обернём App.js в withRouter\n// так, что теперь есть доступ к этому методу\nhistory.push(\"/my-profile\");});}});}}React.useEffect(function(){api.getInitialCards().then(function(cards){setCards(cards);}).catch(function(err){console.log(err);});},[]);React.useEffect(function(){api.getUserInfo().then(function(data){setCurrentUser(data);}).catch(function(err){console.log(err);});},[]);function handleCardLike(card){// Снова проверяем, есть ли уже лайк на этой карточке\nvar isLiked=card.likes.some(function(i){return i._id===currentUser._id;});// Отправляем запрос в API и получаем обновлённые данные карточки\napi.changeLikeStatus(card._id,!isLiked).then(function(newCard){setCards(function(state){return state.map(function(c){return c._id===card._id?newCard:c;});});}).catch(function(err){console.log(err);});}function handleCardDelete(card){setShowLoading(true);api.deleteCard(card._id).then(function(){setCards(function(state){return state.filter(function(item){return item!==card;});});closeAllPopups();}).catch(function(err){console.log(err);}).finally(function(){setShowLoading(false);});}function handleUpdateUser(userData){setShowLoading(true);api.setUserInfo(userData).then(function(data){setCurrentUser(data);closeAllPopups();}).catch(function(err){console.log(err);}).finally(function(){setShowLoading(false);});}function handleUpdateAvatar(data){setShowLoading(true);api.updateUserAvatar(data).then(function(data){setCurrentUser(data);closeAllPopups();}).catch(function(err){console.log(err);}).finally(function(){setShowLoading(false);});}function handleAddPlaceSubmit(data){setShowLoading(true);api.addUserCard(data).then(function(res){setCards([res].concat(_toConsumableArray(cards)));closeAllPopups();}).catch(function(err){console.log(err);}).finally(function(){setShowLoading(false);});}function handleCardClick(card){setSelectedCard(card);}function handleDeleteCardClick(card){setIsDeletePopupOpen(true);setSelectedCardToDelete(card);}function handleEditProfileClick(){setIsEditProfilePopupOpen(true);}function handleAddPlaceClick(){setIsAddPlacePopupOpen(true);}function handleEditAvatarClick(){setIsEditAvatarPopupOpen(true);}function closeAllPopups(){setIsEditAvatarPopupOpen(false);setIsAddPlacePopupOpen(false);setIsEditProfilePopupOpen(false);setIsDeletePopupOpen(false);setIsInfoTooltip(false);setSelectedCard({});setSelectedCardToDelete({});}return/*#__PURE__*/_jsx(Switch,{children:/*#__PURE__*/_jsx(CurrentUserContext.Provider,{value:currentUser,children:/*#__PURE__*/_jsx(\"div\",{className:\"body\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"page\",children:[/*#__PURE__*/_jsx(Header,{loggedIn:loggedIn,userEmail:userEmail,onSignOut:signOut}),/*#__PURE__*/_jsx(Route,{path:\"/sign-up\"}),/*#__PURE__*/_jsx(Route,{path:\"/sign-in\"}),/*#__PURE__*/_jsx(Route,{children:loggedIn?/*#__PURE__*/_jsx(Redirect,{to:\"/my-profile\"}):/*#__PURE__*/_jsx(Redirect,{to:\"/login\"})}),/*#__PURE__*/_jsx(Route,{exact:true,path:\"/login\",children:/*#__PURE__*/_jsx(Login,{onLogin:handleLogin})}),/*#__PURE__*/_jsx(Route,{path:\"/register\",children:/*#__PURE__*/_jsx(Register,{onRegister:handleRegSubmit})}),/*#__PURE__*/_jsx(ProtectedRoute,{path:\"/my-profile\",loggedIn:loggedIn,component:MyProfile,onEditProfile:handleEditProfileClick,onAddPlace:handleAddPlaceClick,onEditAvatar:handleEditAvatarClick,onCardClick:handleCardClick,onCardLike:handleCardLike,onTrashButton:handleDeleteCardClick,cards:cards}),/*#__PURE__*/_jsx(Footer,{}),/*#__PURE__*/_jsx(AddPlacePopup,{isOpen:isAddPlacePopupOpen,onClose:closeAllPopups,onAddPlace:handleAddPlaceSubmit,showLoading:showLoading}),/*#__PURE__*/_jsx(EditProfilePopup,{isOpen:isEditProfilePopupOpen,onClose:closeAllPopups,onUpdateUser:handleUpdateUser,showLoading:showLoading}),/*#__PURE__*/_jsx(EditAvatarPopup,{isOpen:isEditAvatarPopupOpen,onClose:closeAllPopups,onUpdateAvatar:handleUpdateAvatar,showLoading:showLoading}),/*#__PURE__*/_jsx(DeletePopup,{isOpen:isDeletePopupOpen,onClose:closeAllPopups,onCardDelete:handleCardDelete,showLoading:showLoading,card:selectedCardToDelete}),/*#__PURE__*/_jsx(ImagePopup,{card:selectedCard,onClose:closeAllPopups}),/*#__PURE__*/_jsx(InfoTooltip,{onClose:closeAllPopups,isOpen:isInfoTooltip,noMistake:noMistake})]})})})});}export default App;","map":{"version":3,"sources":["/Users/varvarakorableva/Desktop/react-mesto-auth/src/components/App.js"],"names":["React","Route","Switch","Redirect","useHistory","CurrentUserContext","Auth","api","Header","MyProfile","Footer","DeletePopup","ImagePopup","EditAvatarPopup","EditProfilePopup","AddPlacePopup","Login","Register","ProtectedRoute","InfoTooltip","App","useState","cards","setCards","currentUser","setCurrentUser","isEditProfilePopupOpen","setIsEditProfilePopupOpen","isAddPlacePopupOpen","setIsAddPlacePopupOpen","isEditAvatarPopupOpen","setIsEditAvatarPopupOpen","isDeletePopupOpen","setIsDeletePopupOpen","isInfoTooltip","setIsInfoTooltip","selectedCard","setSelectedCard","showLoading","setShowLoading","selectedCardToDelete","setSelectedCardToDelete","loggedIn","setLoggedIn","noMistake","setNoMistake","userEmail","setUserEmail","history","signOut","localStorage","removeItem","push","handleRegSubmit","login","register","password","email","then","res","catch","err","console","log","handleLogin","authorize","token","getContent","useEffect","tokenCheck","jwt","getItem","getInitialCards","getUserInfo","data","handleCardLike","card","isLiked","likes","some","i","_id","changeLikeStatus","newCard","state","map","c","handleCardDelete","deleteCard","filter","item","closeAllPopups","finally","handleUpdateUser","userData","setUserInfo","handleUpdateAvatar","updateUserAvatar","handleAddPlaceSubmit","addUserCard","handleCardClick","handleDeleteCardClick","handleEditProfileClick","handleAddPlaceClick","handleEditAvatarClick"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Route, Switch, Redirect, useHistory } from 'react-router-dom';\nimport {CurrentUserContext} from '../contexts/CurrentUserContext';\nimport * as Auth from './Auth';\nimport {api} from '../utils/Api';\nimport Header from './Header';\nimport MyProfile from './MyProfile';\nimport Footer from './Footer';\nimport DeletePopup from './DeletePopup';\nimport ImagePopup from './ImagePopup';\nimport EditAvatarPopup from './EditAvatarPopup';\nimport EditProfilePopup from './EditProfilePopup';\nimport AddPlacePopup from './AddPlacePopup';\nimport Login from './Login';\nimport Register from './Register';\nimport ProtectedRoute from \"./ProtectedRoute\";\nimport InfoTooltip from './InfoTooltip';\n\n\n\nfunction App() {\n  const [cards, setCards] = React.useState([]);\n  const [currentUser, setCurrentUser] = React.useState({});\n  const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] = React.useState(false);\n  const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = React.useState(false);\n  const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] = React.useState(false);\n  const [isDeletePopupOpen, setIsDeletePopupOpen] = React.useState(false);\n  const [isInfoTooltip, setIsInfoTooltip] = React.useState(false);\n  const [selectedCard, setSelectedCard] = React.useState({});\n  const [showLoading, setShowLoading] = React.useState(false);\n  const [selectedCardToDelete, setSelectedCardToDelete] = React.useState({});\n  const [loggedIn, setLoggedIn] = React.useState(false);\n  const [noMistake, setNoMistake] = React.useState(false);\n  const [userEmail, setUserEmail] = React.useState(\"\");\n  \n  const history = useHistory();\n\n  function signOut(){\n    localStorage.removeItem('jwt');//// как его удалить?\n    setLoggedIn(false)\n    setUserEmail(\"\")\n    history.push('/login');\n  }\n\n  function handleRegSubmit(login){\n    Auth.register({\n      password:login.password,\n      email:login.email,\n  })\n    .then(() => {\n      setNoMistake(true)\n      setIsInfoTooltip(true)\n    }) \n    .then((res) => {\n      history.push('/login');\n    })\n    .catch((err) => {\n      setIsInfoTooltip(true)\n      setNoMistake(false)\n      console.log(err)\n    })\n}\n\n  function handleLogin(password, email){\n    Auth.authorize(password, email)\n      .then ((token) => {\n        Auth.getContent(token)\n          //.then(()=>{console.log(token)})\n          .then(() => {\n            setUserEmail(email)\n            setLoggedIn(true)\n            history.push('/my-profile')\n          })\n      .catch((err) => {\n        console.log(err)\n      })\n      })}\n\n  React.useEffect(() => {\n    tokenCheck();\n  }, []);\n\n  function tokenCheck() {\n    // если у пользователя есть токен в localStorage,\n    // эта функция проверит валидность токена\n      const jwt = localStorage.getItem('jwt');\n    if (jwt){\n      // проверим токен\n      Auth.getContent(jwt).then((res) => {\n        if (res){\n                  // авторизуем пользователя\n          setLoggedIn({\n            loggedIn: true,\n          }, () => {\n                      // обернём App.js в withRouter\n                      // так, что теперь есть доступ к этому методу\n            history.push(\"/my-profile\");\n          });\n        }\n      }); \n    }\n  } \n\n  React.useEffect(() => {\n    api.getInitialCards()\n    .then((cards) => {\n      setCards(cards);\n    })\n    .catch((err) => {\n      console.log(err);\n    });\n  },[]);\n\n  React.useEffect(() => {\n    api.getUserInfo()\n    .then((data) => {\n      setCurrentUser(data);\n    })\n    .catch((err) => {\n      console.log(err);\n    });\n  },[]);\n\n\n  function handleCardLike(card) {\n    // Снова проверяем, есть ли уже лайк на этой карточке\n    const isLiked = card.likes.some(i => i._id === currentUser._id);\n    // Отправляем запрос в API и получаем обновлённые данные карточки\n    api.changeLikeStatus(card._id, !isLiked)\n        .then((newCard) => {\n          setCards((state) => state.map((c) => c._id === card._id ? newCard : c));\n        })\n        .catch((err) => {\n          console.log(err);\n        });\n  } \n\n\n  function handleCardDelete(card) {\n    setShowLoading(true);\n    api.deleteCard(card._id)\n      .then(() => {\n        setCards((state) => state.filter((item) => item !== card))\n        closeAllPopups();\n      })\n      .catch((err) => {\n        console.log(err);\n      })\n      .finally(() => {\n        setShowLoading(false);\n    })\n  }\n\n  function handleUpdateUser(userData) {\n    setShowLoading(true);\n    api.setUserInfo(userData)\n      .then((data) => {\n        setCurrentUser(data);\n        closeAllPopups();\n      })\n      .catch((err) => {\n        console.log(err)\n      })\n      .finally(() => {\n        setShowLoading(false);\n    })\n  }\n\n  function handleUpdateAvatar(data) {\n    setShowLoading(true);\n    api.updateUserAvatar(data)\n      .then((data) => {\n        setCurrentUser(data);\n        closeAllPopups();\n      })\n      .catch((err) => {\n        console.log(err)\n      })\n      .finally(() => {\n        setShowLoading(false);\n    })\n  }\n\n  function handleAddPlaceSubmit(data) {\n    setShowLoading(true);\n    api.addUserCard(data)\n      .then((res) => {\n        setCards([res, ...cards]);\n        closeAllPopups();\n      })\n      .catch((err) => {\n        console.log(err)\n      })\n      .finally(() => {\n        setShowLoading(false);\n    })\n  }\n\n  function handleCardClick(card) {\n    setSelectedCard(card);\n  }\n\n  function handleDeleteCardClick(card) {\n    setIsDeletePopupOpen(true);\n    setSelectedCardToDelete(card);\n  }\n\n  function handleEditProfileClick() {\n    setIsEditProfilePopupOpen(true);\n  }\n\n  function handleAddPlaceClick() {\n    setIsAddPlacePopupOpen(true);\n  }\n\n  function handleEditAvatarClick() {\n    setIsEditAvatarPopupOpen(true);\n  }\n\n  function closeAllPopups() {\n    setIsEditAvatarPopupOpen(false)\n    setIsAddPlacePopupOpen(false)\n    setIsEditProfilePopupOpen(false)\n    setIsDeletePopupOpen(false)\n    setIsInfoTooltip(false)\n    setSelectedCard({})\n    setSelectedCardToDelete({})\n  }\n\n  return (\n    <Switch>\n    <CurrentUserContext.Provider value={currentUser}>\n    <div className=\"body\">\n    <div className=\"page\">\n      \n      <Header \n          loggedIn={loggedIn}\n          userEmail={userEmail}\n          onSignOut={signOut}\n      />\n\n      <Route path=\"/sign-up\">\n      </Route>\n\n      <Route path=\"/sign-in\">\n      </Route>\n\n      <Route>\n          {loggedIn ? (\n            <Redirect to=\"/my-profile\" />\n          ) : (\n            <Redirect to=\"/login\" />\n          )}\n      </Route>\n\n      <Route exact path=\"/login\">\n            <Login  \n            onLogin={handleLogin}/>\n      </Route>\n\n      <Route path=\"/register\">\n            <Register \n            onRegister={handleRegSubmit}\n            />\n      </Route>\n\n      <ProtectedRoute\n          path=\"/my-profile\"\n          loggedIn={loggedIn}\n          component={MyProfile}\n          onEditProfile={handleEditProfileClick}\n          onAddPlace={handleAddPlaceClick}\n          onEditAvatar={handleEditAvatarClick} \n          onCardClick={handleCardClick}\n          onCardLike={handleCardLike}\n          onTrashButton={handleDeleteCardClick}\n          cards={cards}\n      />\n\n      <Footer />\n\n      <AddPlacePopup \n      isOpen={isAddPlacePopupOpen}\n      onClose={closeAllPopups}\n      onAddPlace={handleAddPlaceSubmit}\n      showLoading={showLoading}/>\n\n      <EditProfilePopup \n      isOpen={isEditProfilePopupOpen} \n      onClose={closeAllPopups} \n      onUpdateUser={handleUpdateUser}\n      showLoading={showLoading}/>\n\n      <EditAvatarPopup \n      isOpen={isEditAvatarPopupOpen} \n      onClose={closeAllPopups} \n      onUpdateAvatar={handleUpdateAvatar}\n      showLoading={showLoading}/> \n\n      <DeletePopup \n      isOpen={isDeletePopupOpen}\n      onClose={closeAllPopups}\n      onCardDelete={handleCardDelete}\n      showLoading={showLoading}\n      card={selectedCardToDelete}/>\n\n      <ImagePopup \n      card={selectedCard}\n      onClose={closeAllPopups}\n      />\n\n      <InfoTooltip \n      onClose={closeAllPopups}\n      isOpen={isInfoTooltip}\n      noMistake={noMistake}\n      />\n\n    </div>\n    </div>\n    </CurrentUserContext.Provider>\n    </Switch>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}