{"ast":null,"code":"var _jsxFileName = \"/Users/varvarakorableva/Desktop/react-mesto-auth/src/components/App.js\",\n    _s = $RefreshSig$();\n\nimport React from 'react';\nimport { Route, Switch, Redirect, useHistory } from 'react-router-dom';\nimport { CurrentUserContext } from '../contexts/CurrentUserContext';\nimport * as Auth from './Auth';\nimport { api } from '../utils/Api';\nimport Header from './Header';\nimport MyProfile from './MyProfile';\nimport Footer from './Footer';\nimport DeletePopup from './DeletePopup';\nimport ImagePopup from './ImagePopup';\nimport EditAvatarPopup from './EditAvatarPopup';\nimport EditProfilePopup from './EditProfilePopup';\nimport AddPlacePopup from './AddPlacePopup';\nimport Login from './Login';\nimport Register from './Register';\nimport ProtectedRoute from \"./ProtectedRoute\";\nimport InfoTooltip from './InfoTooltip';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction App() {\n  _s();\n\n  const [cards, setCards] = React.useState([]);\n  const [currentUser, setCurrentUser] = React.useState({});\n  const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] = React.useState(false);\n  const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = React.useState(false);\n  const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] = React.useState(false);\n  const [isDeletePopupOpen, setIsDeletePopupOpen] = React.useState(false);\n  const [isInfoTooltip, setIsInfoTooltip] = React.useState(false);\n  const [selectedCard, setSelectedCard] = React.useState({});\n  const [showLoading, setShowLoading] = React.useState(false);\n  const [selectedCardToDelete, setSelectedCardToDelete] = React.useState({});\n  const [loggedIn, setLoggedIn] = React.useState(false); //const [login, setLogin] = React.useState({});\n\n  const [noMistake, setNoMistake] = React.useState(false);\n  const [userEmail, setUserEmail] = React.useState(\"\");\n  const history = useHistory();\n\n  function signOut() {\n    localStorage.removeItem('jwt'); //// как его удалить?\n\n    setLoggedIn(false);\n    setUserEmail(\"\");\n    history.push('/login');\n  }\n\n  function handleRegSubmit(login) {\n    Auth.register({\n      password: login.password,\n      email: login.email\n    }).then(() => {\n      setNoMistake(true);\n      setIsInfoTooltip(true);\n    }).then(res => {\n      history.push('/login');\n    }).catch(err => {\n      setIsInfoTooltip(true);\n      setNoMistake(false);\n      console.log(err);\n    });\n  }\n\n  function handleLogin(password, email) {\n    Auth.authorize(password, email).then(token => {\n      Auth.getContent(token) //.then(()=>{console.log(token)})\n      .then(() => {\n        setUserEmail(\"email\");\n        setLoggedIn(true);\n        history.push('/my-profile');\n      }).catch(err => {\n        console.log(err);\n      });\n    });\n  }\n\n  React.useEffect(() => {\n    tokenCheck();\n  }, []);\n\n  function tokenCheck() {\n    // если у пользователя есть токен в localStorage,\n    // эта функция проверит валидность токена\n    const jwt = localStorage.getItem('jwt');\n\n    if (jwt) {\n      // проверим токен\n      Auth.getContent(jwt).then(res => {\n        if (res) {\n          // авторизуем пользователя\n          setLoggedIn({\n            loggedIn: true\n          }, () => {\n            // обернём App.js в withRouter\n            // так, что теперь есть доступ к этому методу\n            history.push(\"/my-profile\");\n          });\n        }\n      });\n    }\n  }\n\n  React.useEffect(() => {\n    api.getInitialCards().then(cards => {\n      setCards(cards);\n    }).catch(err => {\n      console.log(err);\n    });\n  }, []);\n  React.useEffect(() => {\n    api.getUserInfo().then(data => {\n      setCurrentUser(data);\n    }).catch(err => {\n      console.log(err);\n    });\n  }, []);\n\n  function handleCardLike(card) {\n    // Снова проверяем, есть ли уже лайк на этой карточке\n    const isLiked = card.likes.some(i => i._id === currentUser._id); // Отправляем запрос в API и получаем обновлённые данные карточки\n\n    api.changeLikeStatus(card._id, !isLiked).then(newCard => {\n      setCards(state => state.map(c => c._id === card._id ? newCard : c));\n    }).catch(err => {\n      console.log(err);\n    });\n  }\n\n  function handleCardDelete(card) {\n    setShowLoading(true);\n    api.deleteCard(card._id).then(() => {\n      setCards(state => state.filter(item => item !== card));\n      closeAllPopups();\n    }).catch(err => {\n      console.log(err);\n    }).finally(() => {\n      setShowLoading(false);\n    });\n  }\n\n  function handleUpdateUser(userData) {\n    setShowLoading(true);\n    api.setUserInfo(userData).then(data => {\n      setCurrentUser(data);\n      closeAllPopups();\n    }).catch(err => {\n      console.log(err);\n    }).finally(() => {\n      setShowLoading(false);\n    });\n  }\n\n  function handleUpdateAvatar(data) {\n    setShowLoading(true);\n    api.updateUserAvatar(data).then(data => {\n      setCurrentUser(data);\n      closeAllPopups();\n    }).catch(err => {\n      console.log(err);\n    }).finally(() => {\n      setShowLoading(false);\n    });\n  }\n\n  function handleAddPlaceSubmit(data) {\n    setShowLoading(true);\n    api.addUserCard(data).then(res => {\n      setCards([res, ...cards]);\n      closeAllPopups();\n    }).catch(err => {\n      console.log(err);\n    }).finally(() => {\n      setShowLoading(false);\n    });\n  }\n\n  function handleCardClick(card) {\n    setSelectedCard(card);\n  }\n\n  function handleDeleteCardClick(card) {\n    setIsDeletePopupOpen(true);\n    setSelectedCardToDelete(card);\n  }\n\n  function handleEditProfileClick() {\n    setIsEditProfilePopupOpen(true);\n  }\n\n  function handleAddPlaceClick() {\n    setIsAddPlacePopupOpen(true);\n  }\n\n  function handleEditAvatarClick() {\n    setIsEditAvatarPopupOpen(true);\n  }\n\n  function closeAllPopups() {\n    setIsEditAvatarPopupOpen(false);\n    setIsAddPlacePopupOpen(false);\n    setIsEditProfilePopupOpen(false);\n    setIsDeletePopupOpen(false);\n    setIsInfoTooltip(false);\n    setSelectedCard({});\n    setSelectedCardToDelete({});\n  }\n\n  return /*#__PURE__*/_jsxDEV(Switch, {\n    children: /*#__PURE__*/_jsxDEV(CurrentUserContext.Provider, {\n      value: currentUser,\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"body\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"page\",\n          children: [/*#__PURE__*/_jsxDEV(Header, {\n            loggedIn: loggedIn,\n            userEmail: userEmail,\n            signOut: signOut\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 237,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(Route, {\n            path: \"/sign-up\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 243,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(Route, {\n            path: \"/sign-in\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 246,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(Route, {\n            children: loggedIn ? /*#__PURE__*/_jsxDEV(Redirect, {\n              to: \"/my-profile\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 251,\n              columnNumber: 13\n            }, this) : /*#__PURE__*/_jsxDEV(Redirect, {\n              to: \"/login\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 253,\n              columnNumber: 13\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 249,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(Route, {\n            exact: true,\n            path: \"/login\",\n            children: /*#__PURE__*/_jsxDEV(Login, {\n              onLogin: handleLogin\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 258,\n              columnNumber: 13\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 257,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(Route, {\n            path: \"/register\",\n            children: /*#__PURE__*/_jsxDEV(Register, {\n              onRegister: handleRegSubmit\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 263,\n              columnNumber: 13\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 262,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(ProtectedRoute, {\n            path: \"/my-profile\",\n            loggedIn: loggedIn,\n            component: MyProfile,\n            onEditProfile: handleEditProfileClick,\n            onAddPlace: handleAddPlaceClick,\n            onEditAvatar: handleEditAvatarClick,\n            onCardClick: handleCardClick,\n            onCardLike: handleCardLike,\n            onTrashButton: handleDeleteCardClick,\n            cards: cards\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 268,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(Footer, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 281,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(AddPlacePopup, {\n            isOpen: isAddPlacePopupOpen,\n            onClose: closeAllPopups,\n            onAddPlace: handleAddPlaceSubmit,\n            showLoading: showLoading\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 283,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(EditProfilePopup, {\n            isOpen: isEditProfilePopupOpen,\n            onClose: closeAllPopups,\n            onUpdateUser: handleUpdateUser,\n            showLoading: showLoading\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 289,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(EditAvatarPopup, {\n            isOpen: isEditAvatarPopupOpen,\n            onClose: closeAllPopups,\n            onUpdateAvatar: handleUpdateAvatar,\n            showLoading: showLoading\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 295,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(DeletePopup, {\n            isOpen: isDeletePopupOpen,\n            onClose: closeAllPopups,\n            onCardDelete: handleCardDelete,\n            showLoading: showLoading,\n            card: selectedCardToDelete\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 301,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(ImagePopup, {\n            card: selectedCard,\n            onClose: closeAllPopups\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 308,\n            columnNumber: 7\n          }, this), /*#__PURE__*/_jsxDEV(InfoTooltip, {\n            onClose: closeAllPopups,\n            isOpen: isInfoTooltip,\n            noMistake: noMistake\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 313,\n            columnNumber: 7\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 235,\n          columnNumber: 5\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 234,\n        columnNumber: 5\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 233,\n      columnNumber: 5\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 232,\n    columnNumber: 5\n  }, this);\n}\n\n_s(App, \"es6F5k/e4qMt3BQAg43Ba4Ue8X4=\", false, function () {\n  return [useHistory];\n});\n\n_c = App;\nexport default App;\n\nvar _c;\n\n$RefreshReg$(_c, \"App\");","map":{"version":3,"sources":["/Users/varvarakorableva/Desktop/react-mesto-auth/src/components/App.js"],"names":["React","Route","Switch","Redirect","useHistory","CurrentUserContext","Auth","api","Header","MyProfile","Footer","DeletePopup","ImagePopup","EditAvatarPopup","EditProfilePopup","AddPlacePopup","Login","Register","ProtectedRoute","InfoTooltip","App","cards","setCards","useState","currentUser","setCurrentUser","isEditProfilePopupOpen","setIsEditProfilePopupOpen","isAddPlacePopupOpen","setIsAddPlacePopupOpen","isEditAvatarPopupOpen","setIsEditAvatarPopupOpen","isDeletePopupOpen","setIsDeletePopupOpen","isInfoTooltip","setIsInfoTooltip","selectedCard","setSelectedCard","showLoading","setShowLoading","selectedCardToDelete","setSelectedCardToDelete","loggedIn","setLoggedIn","noMistake","setNoMistake","userEmail","setUserEmail","history","signOut","localStorage","removeItem","push","handleRegSubmit","login","register","password","email","then","res","catch","err","console","log","handleLogin","authorize","token","getContent","useEffect","tokenCheck","jwt","getItem","getInitialCards","getUserInfo","data","handleCardLike","card","isLiked","likes","some","i","_id","changeLikeStatus","newCard","state","map","c","handleCardDelete","deleteCard","filter","item","closeAllPopups","finally","handleUpdateUser","userData","setUserInfo","handleUpdateAvatar","updateUserAvatar","handleAddPlaceSubmit","addUserCard","handleCardClick","handleDeleteCardClick","handleEditProfileClick","handleAddPlaceClick","handleEditAvatarClick"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Route, Switch, Redirect, useHistory } from 'react-router-dom';\nimport {CurrentUserContext} from '../contexts/CurrentUserContext';\nimport * as Auth from './Auth';\nimport {api} from '../utils/Api';\nimport Header from './Header';\nimport MyProfile from './MyProfile';\nimport Footer from './Footer';\nimport DeletePopup from './DeletePopup';\nimport ImagePopup from './ImagePopup';\nimport EditAvatarPopup from './EditAvatarPopup';\nimport EditProfilePopup from './EditProfilePopup';\nimport AddPlacePopup from './AddPlacePopup';\nimport Login from './Login';\nimport Register from './Register';\nimport ProtectedRoute from \"./ProtectedRoute\";\nimport InfoTooltip from './InfoTooltip';\n\n\n\nfunction App() {\n  const [cards, setCards] = React.useState([]);\n  const [currentUser, setCurrentUser] = React.useState({});\n  const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] = React.useState(false);\n  const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = React.useState(false);\n  const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] = React.useState(false);\n  const [isDeletePopupOpen, setIsDeletePopupOpen] = React.useState(false);\n  const [isInfoTooltip, setIsInfoTooltip] = React.useState(false);\n  const [selectedCard, setSelectedCard] = React.useState({});\n  const [showLoading, setShowLoading] = React.useState(false);\n  const [selectedCardToDelete, setSelectedCardToDelete] = React.useState({});\n  const [loggedIn, setLoggedIn] = React.useState(false);\n  //const [login, setLogin] = React.useState({});\n  const [noMistake, setNoMistake] = React.useState(false);\n  const [userEmail, setUserEmail] = React.useState(\"\");\n  \n  const history = useHistory();\n\n  function signOut(){\n    localStorage.removeItem('jwt');//// как его удалить?\n    setLoggedIn(false)\n    setUserEmail(\"\")\n    history.push('/login');\n  }\n\n  function handleRegSubmit(login){\n    Auth.register({\n      password:login.password,\n      email:login.email,\n  })\n    .then(() => {\n      setNoMistake(true)\n      setIsInfoTooltip(true)\n    }) \n    .then((res) => {\n      history.push('/login');\n    })\n    .catch((err) => {\n      setIsInfoTooltip(true)\n      setNoMistake(false)\n      console.log(err)\n    })\n}\n\n  function handleLogin(password, email){\n    Auth.authorize(password, email)\n      .then ((token) => {\n        Auth.getContent(token)\n          //.then(()=>{console.log(token)})\n          .then(() => {\n            setUserEmail(\"email\")\n            setLoggedIn(true)\n            history.push('/my-profile')\n          })\n      .catch((err) => {\n        console.log(err)\n      })\n      })}\n\n  React.useEffect(() => {\n    tokenCheck();\n  }, []);\n\n  function tokenCheck() {\n    // если у пользователя есть токен в localStorage,\n    // эта функция проверит валидность токена\n      const jwt = localStorage.getItem('jwt');\n    if (jwt){\n      // проверим токен\n      Auth.getContent(jwt).then((res) => {\n        if (res){\n                  // авторизуем пользователя\n          setLoggedIn({\n            loggedIn: true,\n          }, () => {\n                      // обернём App.js в withRouter\n                      // так, что теперь есть доступ к этому методу\n            history.push(\"/my-profile\");\n          });\n        }\n      }); \n    }\n  } \n\n  React.useEffect(() => {\n    api.getInitialCards()\n    .then((cards) => {\n      setCards(cards);\n    })\n    .catch((err) => {\n      console.log(err);\n    });\n  },[]);\n\n  React.useEffect(() => {\n    api.getUserInfo()\n    .then((data) => {\n      setCurrentUser(data);\n    })\n    .catch((err) => {\n      console.log(err);\n    });\n  },[]);\n\n\n  function handleCardLike(card) {\n    // Снова проверяем, есть ли уже лайк на этой карточке\n    const isLiked = card.likes.some(i => i._id === currentUser._id);\n    // Отправляем запрос в API и получаем обновлённые данные карточки\n    api.changeLikeStatus(card._id, !isLiked)\n        .then((newCard) => {\n          setCards((state) => state.map((c) => c._id === card._id ? newCard : c));\n        })\n        .catch((err) => {\n          console.log(err);\n        });\n  } \n\n\n  function handleCardDelete(card) {\n    setShowLoading(true);\n    api.deleteCard(card._id)\n      .then(() => {\n        setCards((state) => state.filter((item) => item !== card))\n        closeAllPopups();\n      })\n      .catch((err) => {\n        console.log(err);\n      })\n      .finally(() => {\n        setShowLoading(false);\n    })\n  }\n\n  function handleUpdateUser(userData) {\n    setShowLoading(true);\n    api.setUserInfo(userData)\n      .then((data) => {\n        setCurrentUser(data);\n        closeAllPopups();\n      })\n      .catch((err) => {\n        console.log(err)\n      })\n      .finally(() => {\n        setShowLoading(false);\n    })\n  }\n\n  function handleUpdateAvatar(data) {\n    setShowLoading(true);\n    api.updateUserAvatar(data)\n      .then((data) => {\n        setCurrentUser(data);\n        closeAllPopups();\n      })\n      .catch((err) => {\n        console.log(err)\n      })\n      .finally(() => {\n        setShowLoading(false);\n    })\n  }\n\n  function handleAddPlaceSubmit(data) {\n    setShowLoading(true);\n    api.addUserCard(data)\n      .then((res) => {\n        setCards([res, ...cards]);\n        closeAllPopups();\n      })\n      .catch((err) => {\n        console.log(err)\n      })\n      .finally(() => {\n        setShowLoading(false);\n    })\n  }\n\n  function handleCardClick(card) {\n    setSelectedCard(card);\n  }\n\n  function handleDeleteCardClick(card) {\n    setIsDeletePopupOpen(true);\n    setSelectedCardToDelete(card);\n  }\n\n  function handleEditProfileClick() {\n    setIsEditProfilePopupOpen(true);\n  }\n\n  function handleAddPlaceClick() {\n    setIsAddPlacePopupOpen(true);\n  }\n\n  function handleEditAvatarClick() {\n    setIsEditAvatarPopupOpen(true);\n  }\n\n  function closeAllPopups() {\n    setIsEditAvatarPopupOpen(false)\n    setIsAddPlacePopupOpen(false)\n    setIsEditProfilePopupOpen(false)\n    setIsDeletePopupOpen(false)\n    setIsInfoTooltip(false)\n    setSelectedCard({})\n    setSelectedCardToDelete({})\n  }\n\n  return (\n    <Switch>\n    <CurrentUserContext.Provider value={currentUser}>\n    <div className=\"body\">\n    <div className=\"page\">\n      \n      <Header \n          loggedIn={loggedIn}\n          userEmail={userEmail}\n          signOut={signOut}\n      />\n\n      <Route path=\"/sign-up\">\n      </Route>\n\n      <Route path=\"/sign-in\">\n      </Route>\n\n      <Route>\n          {loggedIn ? (\n            <Redirect to=\"/my-profile\" />\n          ) : (\n            <Redirect to=\"/login\" />\n          )}\n      </Route>\n\n      <Route exact path=\"/login\">\n            <Login  \n            onLogin={handleLogin}/>\n      </Route>\n\n      <Route path=\"/register\">\n            <Register \n            onRegister={handleRegSubmit}\n            />\n      </Route>\n\n      <ProtectedRoute\n          path=\"/my-profile\"\n          loggedIn={loggedIn}\n          component={MyProfile}\n          onEditProfile={handleEditProfileClick}\n          onAddPlace={handleAddPlaceClick}\n          onEditAvatar={handleEditAvatarClick} \n          onCardClick={handleCardClick}\n          onCardLike={handleCardLike}\n          onTrashButton={handleDeleteCardClick}\n          cards={cards}\n      />\n\n      <Footer />\n\n      <AddPlacePopup \n      isOpen={isAddPlacePopupOpen}\n      onClose={closeAllPopups}\n      onAddPlace={handleAddPlaceSubmit}\n      showLoading={showLoading}/>\n\n      <EditProfilePopup \n      isOpen={isEditProfilePopupOpen} \n      onClose={closeAllPopups} \n      onUpdateUser={handleUpdateUser}\n      showLoading={showLoading}/>\n\n      <EditAvatarPopup \n      isOpen={isEditAvatarPopupOpen} \n      onClose={closeAllPopups} \n      onUpdateAvatar={handleUpdateAvatar}\n      showLoading={showLoading}/> \n\n      <DeletePopup \n      isOpen={isDeletePopupOpen}\n      onClose={closeAllPopups}\n      onCardDelete={handleCardDelete}\n      showLoading={showLoading}\n      card={selectedCardToDelete}/>\n\n      <ImagePopup \n      card={selectedCard}\n      onClose={closeAllPopups}\n      />\n\n      <InfoTooltip \n      onClose={closeAllPopups}\n      isOpen={isInfoTooltip}\n      noMistake={noMistake}\n      />\n\n    </div>\n    </div>\n    </CurrentUserContext.Provider>\n    </Switch>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}